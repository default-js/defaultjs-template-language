!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e,n){"use strict";n.r(e),function(t){const n={global:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},globalVar:function(t,e){return 2===arguments.length&&void 0===n.global[t]&&(n.global[t]=e),n.global[t]}};e.default=n}.call(this,n(2))},function(t,e,n){"use strict";n.r(e),function(t){const n=void 0!==t?t:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};e.default=n}.call(this,n(2))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";n.r(e),function(t){const n=void 0!==t?t:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};e.default=n}.call(this,n(2))},function(t,e){String.prototype.hashcode||(String.prototype.hashcode=function(){if(0===this.length)return 0;let t=0;const e=this.length;for(let n=0;n<e;n++){t=(t<<5)-t+this.charCodeAt(n),t|=0}return t})},function(t,e,n){"use strict";n.r(e);var r=n(1);n(4);const o={},a=async(t,e,n)=>i(create(t,!0),e,n),i=async(t,e,n)=>{let r=null;if(t instanceof HTMLTemplateElement)r=new s(t);else{if(r=document.createElement("template"),!(t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array))throw new Error("Template type is not supported!");r.append(t),r=new s(r,n)}if(!r)throw new Error("Template can't loaded!");return e&&n&&(o[n]=r),r};class s{constructor(t,e){this.template=t,this.key=e}importContent(t=document){return t.importNode(this.template,!0).content.childNodes}remove(){this.key&&o[this.key]&&delete o[this.key]}static async load(t,e=!0,n=null){if(t instanceof s)return t;const r=((t,e,n)=>{if(!e)return null;let r=null;return n?r=n:"string"==typeof t?r=t:t instanceof URL?r=t.toString():t instanceof HTMLElement&&(r=t.selector()),r?r.hashcode():null})(t,e,n);return r&&o[r]?o[r]:"string"==typeof t?a(t,e,r):t instanceof URL?await(async(t,e,n)=>{const r=await fetch(t.toString()),o=await r.text();return a(o,e,n)})(t,e,r):t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection?i(t,e,r):void new Error("The template isn't a allowed type! -> [String|URL|Node|NodeList|HTMLCollection|Template] required!")}}var l=function(){const t=Array.from(arguments),e=t.shift();for(;t.length>0;){t.shift()(e)}},c=n(0);const u=c.default.globalVar("___DOM_API_EXTENSION_MAP___",{});var h=function(t,e){return function(n){let r=u[n.name];r||(r=u[n.name]={}),r[t]?console.warn('duplicated load of extension "'+t+'"!'):(r[t]=!0,e(n.prototype))}};const f=h("EventSupport",t=>{const e=t=>{if(!t.___EVENTHANDLES___){const e=[];t.___EVENTHANDLES___={append:(r,o,a,i)=>{r.forEach(r=>{e.push({event:r,handle:o,wrapper:a,option:i}),n.call(t,r,a,i)})},remove:(n,o)=>{e.filter(t=>(!n||n.indexOf(t.event)>=0)&&(!o||o==t.handle)).forEach(n=>{const o=e.indexOf(n);r.call(t,n.event,n.wrapper),e.splice(o,1)})}}}return t.___EVENTHANDLES___},n=t.addEventListener;t.addEventListener=function(e,n,r){t.on.call(this,e,n,"boolean"==typeof r?{capture:r,once:!1,passive:!1}:r)},t.on=function(){if(arguments.length<2)throw new Error("Too less arguments!");const t=Array.from(arguments),n=t.shift().split(/(\s+)|(\s*,\s*)/),r="string"==typeof t[0]?t.shift():null,o=t.shift(),a=void 0!==t[0]?t.shift():{capture:!1,once:!1,passive:!1},i=function(t){if(r){const e=t.target.nodeType;if(!(e||e!=Node.DOCUMENT_TYPE_NODE&&e!=Node.DOCUMENT_FRAGMENT_NODE||t.target.is(r)))return}const n=o.apply(o,arguments);return a.once&&e(t.currentTarget).remove([t.type],o),n};return e(this).append(n,o,i,a),this};const r=t.removeEventListener;t.removeEventListener=function(){return t.removeOn.apply(this,arguments)},t.removeOn=function(){const t=Array.from(arguments),n="string"==typeof t[0]?t.shift().split(/(\s+)|(\s*,\s*)/):null,r="function"==typeof t[0]?t.shift():null;e(this).remove(n,r)},t.trigger=function(){const t=Array.from(arguments),e=t.shift(),n=t[0]instanceof Event?t.shift():null,r=t.length>1?t:n,o=r?new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r}):new Event(e,{bubbles:!0,cancelable:!0});return n&&(o.delegatedEvent=n),this.dispatchEvent(o),this}});l(EventTarget,f);var p=h("DataSupport",t=>{t.data=function(){if(void 0===this.___data___&&(this.___data___={},void 0!==this.dataset))for(name in this.dataset)this.___data___[name]=this.dataset[name];return 0==arguments.length?this.___data___:1==arguments.length?this.___data___[arguments[0]]:(void 0===arguments[1]||null==arguments[1]?delete this.___data___[arguments[0]]:this.___data___[arguments[0]]=arguments[1],this)}});var d=h("ManipulationSupport",t=>{t.empty=function(){let t=this.childNodes;for(;0!=t.length;)t[0].remove(!0);return this},t.content=function(){return this.childNodes},t.html=function(){return 0==arguments.length?this.innerHTML:1==arguments.length&&"boolean"==typeof arguments[0]?arguments[0]?this.outerHTML:this.innerHTML:(Array.from(arguments).forEach(t=>{"string"==typeof t?this.innerHTML=t:(t instanceof Node||t instanceof NodeList)&&(this.empty(),this.append(t))}),this)};const e=function(){const e=t.appendChild.bind(this);for(let t=0;t<arguments.length;t++){let n=arguments[t];n instanceof Node?this.appendChild(n):"string"==typeof n?create(n).forEach(e):"function"==typeof n.forEach&&n.forEach(e)}};t.append=e;const n=function(t,e){this.insertBefore(e,t)};t.prepend=function(){if(0==this.childNodes.length)e.apply(this,arguments);else{const t=this.childNodes.first(),e=n.bind(this,t);for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):("string"==typeof n||"function"==typeof n.forEach)&&n.forEach(e)}}},t.replace=function(){if(arguments.length<1)throw new Error("Insufficient arguments! One or two nodes required!");const t=1==arguments.length?this.parentNode:this,e=1==arguments.length?this:arguments[0],n=1==arguments.length?arguments[0]:arguments[1];n instanceof Array||n instanceof NodeList||n instanceof HTMLCollection?(n.forEach(n=>t.insertBefore(n,e)),e.remove()):t.replaceChild(n,e)},t.after=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const e=this.parentNode,n=this.nextSibling;n?t.before.apply(n,arguments):t.append.apply(e,arguments)},t.before=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const t=this.parentNode,e=e=>{t.insertBefore(e,this)};for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):("string"==typeof n||"function"==typeof n.forEach)&&n.forEach(e)}}});l(Node,p,d);const m=/:parent(\(\"([^\)]*)\"\))?/i,y=function(t,e){let n=m.exec(e);if(!n)return t.querySelectorAll(e);{let r=t;if(n.index>0&&(r=t.querySelectorAll(e.substr(0,n.index)),0==r.length))return;if(r=r.parent(n[2]),r){let t=e.substr(n.index+n[0].length).trim();return t.length>0&&(r=r.find(t)),r}}};var g=h("QuerySupport",t=>{t.find=function(){let t=[],e=Array.from(arguments),n=e.shift();for(;n;){if("string"==typeof n){let e=y(this,n);e&&t.push(e)}n=e.shift()}let r=NodeList.from.apply(null,t);return r},t.is=function(){if(this instanceof Document)return!1;if(1==arguments.length){if("string"==typeof arguments[0])return this.matches(arguments[0]);if("number"==typeof arguments[0].length){let t=arguments[0];for(let e=0;e<t.length;e++)if(this.matches(t[e]))return!0}}else if(arguments.length>1)return this.is(Array.from(arguments));return!1},t.parent=function(){if(this.parentNode){if("string"==typeof arguments[0]){let t=this.parentNode;try{for(;t&&!t.is(arguments[0]);)t=t.parent(arguments[0])}catch(e){console.error("this:",this,"parent:",t,"error:",e)}return t}return this.parentNode}},t.parents=function(){let e=new Array,n=t.parent.apply(this,arguments);for(;n;)e.push(n),n=t.parent.apply(n,arguments);return NodeList.from(e)},t.selector=function(){if(!(this instanceof Document||this instanceof DocumentFragment)){if(this.id)return"#"+this.id;{let t=this.tagName.toLowerCase(),e=this.parent();if(e){let n=e.find(":scope>"+t);if(n instanceof NodeList){let e=n.indexOf(this);e>0&&(t+=":nth-child("+(e+1)+")")}let r=e.selector();return r?r+">"+t:t}return t}}},t.closest=function(t){let e=this;for(;e;){let n=e.find(t);if(n&&n.length>0)return n;if(e.is(t))return NodeList.from(e);e=e.parent()}},t.nested=function(t){if(this.is(t))return NodeList.from(this);let e=this.find(t);return e&&e.length>0?e:NodeList.from(this.parent(t))}});const v=h("AttributeSupport",t=>{t.attr=function(){return 0==arguments.length?this.hasAttributes()?(()=>{const t={};return this.getAttributeNames().forEach(e=>{t[e]=this.getAttribute(e)}),t})():void 0:1==arguments.length?this.getAttribute(arguments[0]):(void 0===arguments[1]||null==arguments[1]?this.removeAttribute(arguments[0]):this.setAttribute(arguments[0],arguments[1]),this)}});l(Element,g,v,d);const w=h("ReadyEventSupport",t=>{t.ready=function(t,e){return this.on("ready",t,e),"complete"==document.readyState&&this.trigger("ready"),this}});l(Document,g,w),document.addEventListener("DOMContentLoaded",()=>document.trigger("ready")),l(DocumentFragment,g,d);var x=h("HtmlClassSupport",t=>{t.addClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach(t=>this.classList.add(t)):arguments.length>1&&Array.prototype.forEach.call(arguments,t=>this.addClass(t)),this},t.removeClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach(t=>this.classList.remove(t)):arguments.length>1&&Array.prototype.forEach.call(arguments,t=>this.removeClass(t)),this},t.toggleClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach(t=>this.classList.toggle(t)):arguments.length>1&&Array.prototype.forEach.call(arguments,t=>this.toogleClass(t)),this}});const E=h("ShowHideSupport",t=>{t.show=function(){return this.___hidden__&&(this.style.display=this.___display___||"",this.___hidden__=!1),this},t.hide=function(){return this.___hidden__||(this.___display___=this.style.display,this.style.display="none",this.___hidden__=!0),this},t.toggleShow=function(){return this.___hidden__?this.show():this.hide()}});l(HTMLElement,x,E);const _=[{selector:"select",get:function(){const t=[];return this.find("option").forEach(e=>{e.selected&&t.push(e.value)}),t},set:function(){let t=[];const e=Array.from(arguments);let n=e.shift();for(;n;)Array.isArray(n)?t=t.concat(n):t.push(n),n=e.shift();this.value=t,this.find("option").forEach(e=>e.selected=t.indexOf(e.value)>=0),this.trigger("changed")}},{selector:'input[type="checkbox"], input[type="radio"]',get:function(){return"on"==this.value||"off"==this.value?this.checked:this.checked?this.value:void 0},set:function(t){"boolean"==typeof t?this.checked=t:"string"==typeof t?this.checked=this.value==t:Array.isArray(t)&&(this.checked=t.indexOf(this.value)>=0),this.trigger("changed")}}],N={get:function(){return this.value},set:function(t){this.value=t,this.trigger("input")}},T=function(t){for(let e=0;e<_.length;e++)if(t.is(_[e].selector))return _[e];return N};var b=h("ValueSupport",t=>{t.val=function(){let t=T(this);return 0==arguments.length?t.get.apply(this,arguments):(t.set.apply(this,arguments),this)}});l(HTMLInputElement,b),l(HTMLTextAreaElement,h("ValueSupport",t=>{t.val=function(){return 0==arguments.length?this.value:(this.value=arguments[0],this)}})),l(HTMLSelectElement,b);var L=function(){const t=Array.from(arguments),e=t.shift(),n=t.shift();t.forEach(t=>{Object.getOwnPropertyNames(t).forEach(r=>{const o=Object.getOwnPropertyDescriptor(t,r);void 0===n[r]&&"function"==typeof o.value&&(n[r]=function(){return e.call(this,r,arguments)})})})};var A=h("ListSupport",t=>{t.indexOf=function(){for(let t=0;t<this.length;t++)if(this[t]==arguments[0])return t;return-1},t.forEach=function(){return Array.prototype.forEach.apply(Array.from(this),arguments)},t.map=function(){return Array.prototype.map.apply(Array.from(this),arguments)},t.filter=function(){return Array.prototype.filter.apply(Array.from(this),arguments)},t.first=function(){if(this.length>0)return this[0]},t.last=function(){if(this.length>0)return this[this.length-1]}});l(NodeList,A),NodeList.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,r=[];for(let o=0;o<this.length;o++){const a=this[o];let i;n?i=e.apply([a].concat(t)):"function"==typeof a[e]&&(i=a[e].apply(a,t)),i&&r.push(i)}return r},NodeList.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach(e=>{if("function"==typeof e.val){e.val()&&t.set(e.name||e.id||e.selector(),e.val())}}),t}}else NodeList.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},NodeList.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const r=t.shift();if(void 0!==r&&null!=r)if(r instanceof Node)e[n++]={value:r,enumerable:!0};else if(r instanceof NodeList||r instanceof HTMLCollection||r instanceof Array)for(let t=0;t<r.length;t++)r[t]&&r[t]instanceof Node&&(e[n++]={value:r[t],enumerable:!0})}return e.length={value:n},Object.create(NodeList.prototype,e)},L((function(t,e){let n=[];return this.forEach(r=>{if(r&&"function"==typeof r[t]){const o=r[t].apply(r,e);o&&(o instanceof NodeList?n=n.concat(Array.from(o)):n.push(o))}}),0===n.length?void 0:n[0]instanceof Node||n[0]instanceof NodeList?NodeList.from.apply(null,n):n}),NodeList.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),l(HTMLCollection,A),HTMLCollection.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,r=[];for(let o=0;o<this.length;o++){const a=this[o];let i;n?i=e.apply([a].concat(t)):"function"==typeof a[e]&&(i=a[e].apply(a,t)),i&&r.push(i)}return r},HTMLCollection.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach(e=>{if("function"==typeof e.val){e.val()&&t.set(e.name||e.id||e.selector(),e.val())}}),t}}else HTMLCollection.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},HTMLCollection.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const r=t.shift();if(void 0!==r&&null!=r)if(r instanceof HTMLElement)e[n++]={value:r,enumerable:!0};else if(r instanceof HTMLCollection||r instanceof NodeList||r instanceof Array)for(let t=0;t<r.length;t++)r[t]&&r[t]instanceof HTMLElement&&(e[n++]={value:r[t],enumerable:!0})}return e.length={value:n},Object.create(HTMLCollection.prototype,e)},L((function(t,e){let n=[];return this.forEach(r=>{if(r&&"function"==typeof r[t]){let o=r[t].apply(r,e);o&&(o instanceof HTMLCollection?n=n.concat(Array.from(o)):n.push(o))}}),0===n.length?void 0:n[0]instanceof HTMLElement||n[0]instanceof HTMLCollection?HTMLCollection.from.apply(null,n):n}),HTMLCollection.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),c.default.global.defaultjs=c.default.global.defaultjs||{},c.default.global.defaultjs.extdom=c.default.global.defaultjs.extdom||{VERSION:"1.0.0-beta.9",utils:{Utils:c.default}},c.default.global.find=function(){return document.find.apply(document,arguments)},c.default.global.ready=function(){return document.ready.apply(document,arguments)},c.default.global.create=function(t,e){if("string"!=typeof arguments[0])throw new Error("The first argument must be a string!");const n=document.createElement("template");return n.innerHTML=t,e?n:document.importNode(n.content,!0).childNodes},c.default.global.script=function(t,e){return t instanceof Array?Promise.all(t.map(t=>c.default.global.script(t,e))):"string"==typeof t?new Promise((n,r)=>{const o=document.createElement("script");o.async=!0,o.onload=function(){n()},o.onerror=function(){r("jquery load error!")},e?e.append(o):document.body.append(o),o.src=t}):Promise.reject("First parameter must be an array of strings or a string!")};var M=n(3);class j{constructor(t,e){this.key=t,this.context=e}get keyDefined(){return this.key in this.context}get hasValue(){return!!this.context[this.key]}get value(){return this.context[this.key]}set value(t){this.context[this.key]=t}set append(t){if(this.hasValue){const e=this.value;e instanceof Array?e.push(t):this.value=[this.value,t]}else this.value=t}remove(){delete this.context[this.key]}static load(t,e,n=!0){let r=t;const o=e.split(".");let a=o.shift().trim();for(;o.length>0;){if(!r[a]){if(!n)return null;r[a]={}}r=r[a],a=o.shift().trim()}return new j(a,r)}}const H=function(t){return void 0!==t&&null!=t&&"Object"===t.constructor.name},C=function(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];Object.getOwnPropertyNames(n).forEach(e=>{H(t[e])?C(t[e],n[e]):t[e]=n[e]})}return t},P=function(){const[t,e,{deep:n=!1,recursive:r=!0,parents:o=[]}={}]=arguments,a={};for(name in t){const i=t[name],s=e(name,i,t);if(!s||n&&null!=i){if(s&&n){"object"!==typeof i||i instanceof Array||i instanceof Map||i instanceof Set||i instanceof RegExp||o.includes[i]||i==t?a[name]=i:a[name]=P(i,e,{deep:n,recursive:r,parents:o.concat(t)})}}else a[name]=i}return a};var S={isPojo:H,append:function(t,e,n){if(void 0!==e){j.load(n,t,!0).append=e}return n},merge:C,filter:P,buildPropertyFilter:function({names:t,allowed:e}){return(n,r,o)=>t.includes(n)===e}};class O{constructor(t){this.hasValue=1==arguments.length,this.value=t}}class D{constructor(t,e){this.data=t,this.resolver=e,this.cache=new Map}updateData(t){this.data=t,this.cache=new Map}resetCache(){this.cache=new Map}getPropertyDef(t,e=!0){if(this.cache.has(t))return this.cache.get(t);let n=null;if(this.data&&t in this.data)n={data:this.data,resolver:this.resolver,defined:!0};else{if(!e)return null;n=((t,e)=>{for(;t;){const n=t.proxy.handle.getPropertyDef(e,!1);if(n)return n;t=t.parent}return{data:null,resolver:null,defined:!1}})(this.resolver.parent,t)}return n.defined&&this.cache.set(t,n),n}hasProperty(t){const{defined:e}=this.getPropertyDef(t);return e}getProperty(t){const{data:e}=this.getPropertyDef(t);return e?e[t]:void 0}setProperty(t,e){const{data:n,defined:r}=this.getPropertyDef(t);r?n[t]=e:(this.data||(this.data={}),this.data[t]=e,this.cache.set(t,{data:this.data,resolver:this.resolver,defined:!0}))}deleteProperty(t){throw new Error("unsupported function!")}}class k{constructor(t,e){this.handle=new D(t,e),this.data=new Proxy(this.handle,{has:function(t,e){return t.hasProperty(e)},get:function(t,e){return t.getProperty(e)},set:function(t,e,n){return t.setProperty(e,n)},deleteProperty:function(t,e){return t.deleteProperty(e)}})}updateData(t){this.handle.updateData(t)}resetCache(){this.handle.resetCache()}}const R=/\$\{(([a-zA-Z0-9\-_\s]+)::)?([^\{\}]+)\}/,I=new O,V=t=>t instanceof O?t:new O(t),K=async function(t,e,n,r){if(n&&t.name!=n)return t.parent?K(t.parent,e,n,r):null;const o=await function(t,e){if("string"!=typeof t)return t;return new Function("context",`try{with(context){return ${t}}}catch(e){throw e;}`)(e)}(e,t.proxy.data);return null!=o?o:r instanceof O&&r.hasValue?r.value:o},F=t=>t?0==(t=t.trim()).length?null:t:null;class q{constructor({context:t=M.default,parent:e=null,name:n=null}){this.parent=e instanceof q?e:null,this.name=n,this.context=t,this.proxy=new k(this.context,this)}get chain(){return this.parent?this.parent.chain+"/"+this.name:"/"+this.name}get effectiveChain(){return this.context?this.parent?this.parent.effectiveChain+"/"+this.name:"/"+this.name:this.parent?this.parent.effectiveChain:""}get contextChain(){const t=[];let e=this;for(;e;)e.context&&t.push(e.context),e=e.parent;return t}getData(t,e){if(t){if(!e||e==this.name){const e=j.load(this.context,t,!1);return e?e.value:null}this.parent&&this.parent.getData(t,e)}}updateData(t,e,n){if(t)if(n&&n!=this.name)this.parent&&this.parent.updateData(t,e,n);else{null!=this.context&&void 0!==this.context||(this.context={},this.proxy.updateData(this.context));j.load(this.context,t).value=e,this.proxy.resetCache()}}mergeContext(t,e){e&&e!=this.name?this.parent&&this.parent.mergeContext(t,e):this.context=this.context?S.merge(this.context,t):t}async resolve(t,e){const n=2==arguments.length?V(e):I;try{const e=R.exec(t);return e?await K(this,e[3],F(e[2]),n):await K(this,F(t),null,n)}catch(e){return console.error('error at executing statment"',t,'":',e),n.hasValue?n.value:t}}async resolveText(t,e){let n=t,r=t,o=R.exec(n);const a=2==arguments.length?V(e):I;for(;null!=o;){const t=await this.resolve(o[0],a);r=r.split(o[0]).join(),n=n.split(o[0]).join(void 0===t?"undefined":null==t?"null":t),o=R.exec(r)}return n}static async resolve(t,e,n,r){const o=new q({context:e}),a=arguments.length>2?V(n):I;return"number"==typeof r&&r>0?new Promise(e=>{setTimeout(()=>{e(o.resolve(t,a))},r)}):o.resolve(t,a)}static async resolveText(t,e,n,r){const o=new q({context:e}),a=arguments.length>2?V(n):I;return"number"==typeof r&&r>0?new Promise(e=>{setTimeout(()=>{e(o.resolveText(t,a))},r)}):o.resolveText(t,a)}static buildSecure({context:t,propFilter:e,option:n={deep:!0},name:r,parent:o}){return t=S.filter({data:t,propFilter:e,option:n}),new q({context:t,name:r,parent:o})}}class U{constructor({resolver:t,renderer:e,template:n,container:r,root:o,mode:a="replace",target:i=null,parent:s=null}){if(!t)throw new Error('Parameter "resolver" is required!');if(!e)throw new Error('Parameter "renderer" is required!');if(!n)throw new Error('Parameter "template" is required!');if(!r)throw new Error('Parameter "container" is required!');if(!o)throw new Error('Parameter "root" is required!');this.readyHandles=[],this.content=null,this.template=n,this.container=r,this.resolver=t,this.mode=a,this.renderer=e,this.root=o,this.target=i,this.parent=s,this.closed=!1,this.wait=(t=>{let e=null;const n=new Promise(t=>{e=t});return n.object=t,n.finished=async()=>{await e()},n})(this),this.stop=!1,this.ignore=!1}async finish(t){this.closed||(this.parent?this.parent.finish(t):this.ready(t))}async ready(t){if(!this.closed)if(t)t instanceof Array?t.forEach(t=>{this.ready=t}):(t instanceof Promise||"function"==typeof t)&&this.readyHandles.push(t);else{if(this.closed=!0,this.readyHandles.length>0){const t=new Error("timeout");try{await Promise.race([Promise.all(this.readyHandles.map(t=>t instanceof Promise?t:t(this))),new Promise((e,n)=>{setTimeout(()=>{n(t)},2e3)})])}catch(t){console.log(t),console.log(new Error("timeout"))}}this.wait.finished()}}subContext({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:r=this.container,root:o=this.root,mode:a=this.mode,target:i=this.target}={}){return new U({resolver:t,renderer:e,template:n,container:r,mode:a,root:o,target:i,parent:this})}clone({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:r=this.container,root:o=this.root,mode:a=this.mode,target:i=this.target}={}){return new U({resolver:t,renderer:e,template:n,container:r,mode:a,root:o,target:i,parent:this})}}const X=[],$={init:0,data:1,template:2,content:3,finish:4};class B{static get PHASE(){return $}static get MIN_RANK(){return 0}static get MAX_RANK(){return 1e5}constructor(){}get name(){}get rank(){}get phase(){return $.finish}async execute(t){return t}static define(t){(({directive:t})=>{if(!(t instanceof B))throw new Error("Implementation dosn't extend Directive class!");if(t.rank<B.MIN_RANK)throw new Error("The rank of a directive can't be lower as "+B.MIN_RANK+"!");if(t.rank>B.MAX_RANK)throw new Error("The rank of a directive can't be grater as "+B.MAX_RANK+"!");X.push(t),X.sort((t,e)=>{const n=t.phase-e.phase;return 0==n?t.rank-e.rank:n})})(t)}static get directives(){return X}}class z extends HTMLElement{constructor(){super(),this.hidden=!0}async execute({template:t,context:e}){return e.content=t.cloneNode(!0),e}}class J extends z{constructor(){super(),this.attachShadow({mode:"open"})}async execute({template:t,context:e}){return e}}try{customElements.define("jstl-replace",J)}catch(t){}B.define({directive:new class extends B{constructor(){super()}get name(){return"initial"}get rank(){return B.MIN_RANK}get phase(){return B.PHASE.init}async execute(t){const{template:e}=t;return e instanceof Text?t.content=document.importNode(e,!0):e.attr("jstl-async")?(t.content=new J,e.attr("jstl-async",null),setTimeout(async()=>{await t.renderer.render({mode:"replace",target:t.content,context:t})},parseInt(e.attr("jstl-async")||"250")||250),t.stop=!0,t.ignore=!0):e.attr("jstl-ignore")?(t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0):e.tagName?t.content=document.createElement(e.tagName):(t.stop=!0,t.ignore=!0),t}}});const G={remote:async({data:t,context:e})=>{const{resolver:n,template:r}=e;t=await n.resolveText(t),t=new URL(t,location.origin);let o=await n.resolveText(r.attr("jstl-data-option")||"{}");return o=JSON.parse(o),(t=await fetch(t.toString(),o)).json()},direct:async({data:t,context:e})=>{const{resolver:n}=e;return t=await n.resolveText(t)}};B.define({directive:new class extends B{constructor(){super()}get name(){return"data"}get rank(){return 1e3}get phase(){return B.PHASE.data}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-data")))return t;try{const{template:e}=t,n=G[e.attr("jstl-data-mode")||"remote"];if(!n)throw new Error("The jstl-data-mode is unsupported!");let r=e.attr("jstl-data");r=await n({data:r,context:t});const o=e.attr("jstl-data-var");t=(({varname:t,data:e,scope:n,context:r})=>(t?r.resolver.updateData(t,e,n):n?r.resolver.mergeContext(e,n):r.resolver=new q({context:e,name:"jstl-data",parent:r.resolver}),r))({varname:o,data:r,scope:e.attr("jstl-data-scope"),context:t})}catch(e){console.error(e,t.template)}return t}}});B.define({directive:new class extends B{constructor(){super()}get name(){return"if"}get rank(){return B.MIN_RANK+1e3}get phase(){return B.PHASE.init}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement&&e.attr("jstl-if")))return t;const n=e.attr("jstl-if"),r=t.resolver;return await r.resolve(n,!1)||(t.content=null,t.stop=!0,t.ignore=!0),t}}});B.define({directive:new class extends B{constructor(){super()}get name(){return"choose"}get rank(){return B.MIN_RANK+1}get phase(){return B.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.hasAttribute("jstl-choose")&&0!=t.template.children.length))return t;const{template:e,resolver:n}=t;let r=!1;const o=e.find(":scope > [jstl-when]"),a=o.length;for(let t=0;t<a;t++){const e=o[t];!r&&await n.resolve(e.attr("jstl-when"),!1)?r=!0:e.remove()}return r&&e.find(":scope > [jstl-otherwise]").remove(),t}}});B.define({directive:new class extends B{constructor(){super()}get name(){return"include"}get rank(){return B.MIN_RANK}get phase(){return B.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-include")))return t;try{const{template:e,resolver:n,renderer:r}=t;let o=e.attr("jstl-include");o=await n.resolveText(o),o=new URL(o,location.origin),o=await s.load(o);const a=e.attr("jstl-include-mode")||"replace";return await r.render({template:o,container:t.content,mode:a,context:t}),t.ignore,t}catch(e){return console.error(e,t.template),t}}}});const Q="jstl-foreach",Y="jstl-foreach-var",Z="jstl-foreach-status",W="jstl-foreach-count",tt="jstl-foreach-start",et="jstl-foreach-step",nt="jstl-foreach-condition",rt=async(t,e)=>{let{template:n,resolver:r,renderer:o,container:a,condition:i,context:s}=e;return r=new q({context:t,name:"jstl-foreach",parent:r}),i=!!i&&await r.resolve(i,!1),!i&&(await o.render({context:s.clone({resolver:r,container:a,template:n,mode:"append"})}),!0)};B.define({directive:new class extends B{constructor(){super()}get name(){return"foreach"}get rank(){return B.MIN_RANK+2}get phase(){return B.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement)||!t.template.attr(Q)&&!t.template.attr(W))return t;t.ignore=!0;try{const{template:e,resolver:n,renderer:r,content:o}=t,a={data:(e.attr(Q)||"").trim(),count:(e.attr(W)||"").trim(),start:await n.resolve(e.attr(tt)||"0"),step:await n.resolve(e.attr(et)||"1"),varname:(e.attr(Y)||"item").trim(),status:(e.attr(Z)||"status").trim(),condition:e.attr(nt),template:e.childNodes,resolver:n,renderer:r,container:o,context:t};a.data&&""!=a.data||!a.count?await(async t=>{let{data:e,start:n,step:r,count:o,varname:a,status:i,resolver:s}=t;e=await s.resolve(e);let l=e;e instanceof Array||(l=Object.getOwnPropertyNames(e)),o=""!=o?await s.resolve(o,0):null;const c=o?Math.min(n+o,l.length):l.length;let u=!1;for(let o=n;o<c&&!u;o+=r){const n={};n[a]=e[o],n[i]={index:o,number:o+1,count:c,data:e},u=!await rt(n,t)}})(a):await(async t=>{let{start:e,step:n,count:r,varname:o,status:a,resolver:i}=t;r=await i.resolve(r);const s=e+r*n;let l=!1;for(let i=e;i<s&&!l;i+=n){const e={};e[o]=i,e[a]={index:i,number:i+1,step:n,count:r},l=!await rt(e,t)}})(a)}catch(t){console.error("error at jstl-foreach:",t)}return t}}});const ot={mode:"text",unsecure:!1,preventFormat:!1,maxLength:0},at={text:async(t,e)=>{const{content:n,resolver:r,template:o}=e;let a=await r.resolveText(o.textContent);a=create(a,!0).content.textContent,t.maxLength>0&&(a=((t,e)=>t.length>e?t.substring(0,e-3).trim()+"...":t)(a,t.maxLength)),n.textContent=a},html:async(t,e)=>{const{resolver:n,template:r}=e;let o=await n.resolveText(r.textContent);o=create(o,!0),o=document.importNode(o.content,!0),t.unsecure||o.find("script, style, body, html, head, object, link").remove(),e.content=o}};B.define({directive:new class extends B{constructor(){super()}get name(){return"text"}get rank(){return B.MIN_RANK+1}get phase(){return B.PHASE.content}async execute(t){const{template:e}=t;if(!(e instanceof Text)||0==e.textContent.trim().length||e.parentElement&&e.parentElement.hasAttribute("jstl-text-ignore"))return t;const n=e.parentElement,r=n?await(async(t,e)=>{const n=e.resolver;return{mode:await n.resolveText((t.attr("jstl-text-content-type")||"text").trim().toLowerCase()),unsecure:t.hasAttribute("jstl-text-unsecure"),preventFormat:!!t.attr("jstl-text-prevent-format")||!1,maxLength:parseInt(await n.resolveText(t.attr("jstl-text-trim-length")||"0"))}})(n,t):ot,o=at[r.mode];if(!o)throw new Error('Text mode "'+r.mode+'" is unsupported!');return await o(r,t),t}}});const it=/(jstl)?(\?)?(@)?([^\?@]+)/i,st=async({condition:t,name:e,value:n,context:r})=>{const{resolver:o,content:a,template:i}=r;let s=t?i.attr(e):n;(t=t?n:i.attr("?"+e))&&s?!0===(t=await o.resolve(t,!1))&&a.attr(e,await o.resolveText(s,s)):t?!0===(t=await o.resolve(t,!1))&&a.attr(e,!0):s&&a.attr(e,await o.resolveText(s,s))},lt=async({condition:t,name:e,value:n,context:r})=>{const{resolver:o,template:a}=r;let i=(t=t?n:a.attr("?@"+e))?a.attr("@"+e):n,s=e.split(":");const l=s.shift(),c=s.shift()||"default";(t&&i&&1==await o.resolve(t,!1)||i)&&await ct({event:l,type:c,handle:i,context:r})},ct=async({event:t,type:e,handle:n,context:r})=>{const{resolver:o,content:a}=r;if("delegate"==e){const e=await o.resolveText(n,n);a.on(t,ut(e))}else{const e=await o.resolve(n,n);if(e){if("function"==typeof e)a.on(t,e);else if("string"==typeof e)a.on(t,ut(e));else if("object"==typeof e){const{capture:r=!1,passive:o=!1,once:i=!1}=n;a.on(t,e.eventHandle,{capture:r,passive:o,once:i})}}else console.error(new Error("Can't resolve \""+n+'" to event handle!'))}},ut=function(t){return function(e){e.preventDefault(),e.stopPropagation(),e.currentTarget?e.currentTarget.trigger(t,e):e.target.trigger(t,e)}};B.define({directive:new class extends B{constructor(){super()}get name(){return"attribute"}get rank(){return B.MIN_RANK}get phase(){return B.PHASE.content}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement))return t;const n=new Set;for(const r of e.attributes){const[,e,o,a,i]=it.exec(r.name);if(!e&&!n.has(i)){const e=r.value;a?await lt({condition:o,event:a,name:i,value:e,context:t}):await st({condition:o,name:i,value:e,context:t})}n.add(i)}return t}}});const ht="data",ft="render",pt="node",dt=new q({name:"application"}),mt={replace:async({container:t,target:e=null,content:n})=>{e?e.replace(n):(t.empty(),t.append(n))},append:async({container:t,target:e=null,content:n})=>{e?e.after(n):t.append(n)},prepend:async({container:t,target:e=null,content:n})=>{e?e.before(n):t.prepend(n)}};class yt{constructor({template:t,data:e}={}){if(t&&!(t instanceof s))throw new Error("template must be an instance of Template!");this.template=t,this.resolver=new q({name:ht,context:e||{},parent:dt})}async render({template:t=null,data:e=null,container:n,root:r,mode:o,target:a,context:i=null}){t=await(async(t,e,n)=>{if(t)return(t=await s.load(t)).importContent();if(e)return e.template;if(n.template)return await n.template.importContent();throw new Error("No content template specified!")})(t,i,this);let l=new q({name:ft,context:e,parent:i?i.resolver:this.resolver}),c=i;c=c?c.clone({resolver:l,template:t,container:n,root:r,mode:o,target:a}):new U({resolver:l,renderer:this,template:t,container:n,root:r||n,mode:o||"replace",target:a});let u=null;if(u=t instanceof Node?await this.renderNode(c):await this.renderContainer(c),u instanceof U&&(c=u),c.content&&c.mode){const t=mt[c.mode];if(!t)throw new Error('The "'+c.mode+'" is not supported!');await t(c)}return i?c.ready():await c.ready(),i}async renderContainer(t){if(t.template&&t.template.length>0){const e=t.template.map(e=>{const n=new q({name:pt,context:null,parent:t.resolver});return this.renderNode(t.clone({template:e,resolver:n}))}),n=await Promise.all(e);if(!n)return t;t.content=n.filter(t=>!!t).reduce((t,e)=>{const n=e.content;return n instanceof Array&&(t=t.concat(n)),n instanceof NodeList||n instanceof HTMLCollection?t=t.concat(Array.from(n)):n instanceof Node&&t.push(n),e.ready(),t},[])}return t}async renderNode(t){try{if(t.template.normalize(),t.template instanceof z?await t.template.execute(t):await this.executeDirectives(t),!t.ignore&&t.content){const e=t.template.childNodes;e&&e.length>0&&await t.renderer.render({context:t.clone({template:e,container:t.content})})}t.content&&t.content.tagName&&"JSTL"==t.content.tagName&&(t.content=t.content.childNodes)}catch(e){console.error("error at render node:",e,t)}return t}async executeDirectives(t){const e=B.directives,n=e.length;for(let r=0;r<n&&!t.stop;r++){const n=e[r];try{const e=await n.execute(t);e instanceof U&&(t=e)}catch(e){console.error("error at directive:",e,n,t)}}return t}static async build({template:t,data:e}={}){return t&&t instanceof Promise&&(t=await t),t=t?await s.load(t):null,new yt({template:t,data:e})}static async render({container:t,data:e,template:n,mode:r,target:o}){return new yt({template:n,data:e}).render({container:t,mode:r,target:o})}}r.default.defaultjs=r.default.defaultjs||{},r.default.defaultjs.jstl=r.default.defaultjs.tl=r.default.defaultjs.tl||{VERSION:"1.0.0-beta.9",Template:s,Renderer:yt}}]);
//# sourceMappingURL=defaultjs-template-language.min.js.map