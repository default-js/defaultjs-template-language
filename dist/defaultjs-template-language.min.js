!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e,n){"use strict";n.r(e),function(t){const n={global:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},globalVar:function(t,e){return 2===arguments.length&&void 0===n.global[t]&&(n.global[t]=e),n.global[t]}};e.default=n}.call(this,n(2))},function(t,e,n){"use strict";n.r(e),function(t){const n=void 0!==t?t:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};e.default=n}.call(this,n(2))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";n.r(e),function(t){const n=void 0!==t?t:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};e.default=n}.call(this,n(2))},function(t,e){String.prototype.hashcode||(String.prototype.hashcode=function(){if(0===this.length)return 0;let t=0;const e=this.length;for(let n=0;n<e;n++){t=(t<<5)-t+this.charCodeAt(n),t|=0}return t})},function(t,e,n){"use strict";n.r(e);var r=n(1);n(4);const o={},i=async(t,e,n)=>a(create(t,!0),e,n),a=async(t,e,n)=>{let r=null;if(t instanceof HTMLTemplateElement)r=new s(t);else{if(r=document.createElement("template"),t instanceof Node)r.append(t.cloneNode(!0));else{if(!(t instanceof NodeList||t instanceof HTMLCollection))throw new Error("Template type is not supported!");r.append(t.map(t=>t.cloneNode(!0)))}r=new s(r,n)}return e&&n&&(o[n]=r),r};class s{constructor(t,e){this.template=t,this.key=e}importContent(){return document.importNode(this.template,!0).content.childNodes}remove(){this.key&&o[this.key]&&delete o[this.key]}static async load(t,e=!0,n=null){if(t instanceof s)return t;const r=((t,e,n)=>{if(!e)return null;let r=null;return n?r=n:"string"==typeof t?r=t:t instanceof URL?r=t.toString():t instanceof HTMLElement&&(r=t.selector()),r?r.hashcode():null})(t,e,n);return r&&o[r]?o[r]:"string"==typeof t?i(t,e,r):t instanceof URL?await(async(t,e,n)=>{const r=await fetch(t.toString()),o=await r.text();return i(o,e,n)})(t,e,r):t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection?a(t,e,r):void new Error("The template isn't a allowed type! -> [String|URL|Node|NodeList|HTMLCollection] required!")}}var l=function(){const t=Array.from(arguments),e=t.shift();for(;t.length>0;){t.shift()(e)}},c=n(0);const u=c.default.globalVar("___DOM_API_EXTENSION_MAP___",{});var f=function(t,e){return function(n){let r=u[n.name];r||(r=u[n.name]={}),r[t]?console.warn('duplicated load of extension "'+t+'"!'):(r[t]=!0,e(n.prototype))}};const h=f("EventSupport",t=>{const e=t=>{if(!t.___EVENTHANDLES___){const e=[];t.___EVENTHANDLES___={append:(r,o,i,a)=>{r.forEach(r=>{e.push({event:r,handle:o,wrapper:i,option:a}),n.call(t,r,i,a)})},remove:(n,o)=>{e.filter(t=>(!n||n.indexOf(t.event)>=0)&&(!o||o==t.handle)).forEach(n=>{const o=e.indexOf(n);r.call(t,n.event,n.wrapper),e.splice(o,1)})}}}return t.___EVENTHANDLES___},n=t.addEventListener;t.addEventListener=function(e,n,r){t.on.call(this,e,n,"boolean"==typeof r?{capture:r,once:!1,passive:!1}:r)},t.on=function(){if(arguments.length<2)throw new Error("Too less arguments!");const t=Array.from(arguments),n=t.shift().split(/(\s+)|(\s*,\s*)/),r="string"==typeof t[0]?t.shift():null,o=t.shift(),i=void 0!==t[0]?t.shift():{capture:!1,once:!1,passive:!1},a=function(t){if(r){const e=t.target.nodeType;if(!(e||e!=Node.DOCUMENT_TYPE_NODE&&e!=Node.DOCUMENT_FRAGMENT_NODE||t.target.is(r)))return}const n=o.apply(o,arguments);return i.once&&e(t.currentTarget).remove([t.type],o),n};return e(this).append(n,o,a,i),this};const r=t.removeEventListener;t.removeEventListener=function(){return t.removeOn.apply(this,arguments)},t.removeOn=function(){const t=Array.from(arguments),n="string"==typeof t[0]?t.shift().split(/(\s+)|(\s*,\s*)/):null,r="function"==typeof t[0]?t.shift():null;e(this).remove(n,r)},t.trigger=function(){const t=Array.from(arguments),e=t.shift(),n=t.length>1?t.shift():null,r=n?new Event(e,!0,!0):new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});return n instanceof Event&&(r.delegatedEvent=n),this.dispatchEvent(r),this}});l(EventTarget,h);var d=f("DataSupport",t=>{t.data=function(){if(void 0===this.___data___&&(this.___data___={},void 0!==this.dataset))for(name in this.dataset)this.___data___[name]=this.dataset[name];return 0==arguments.length?this.___data___:1==arguments.length?this.___data___[arguments[0]]:(void 0===arguments[1]||null==arguments[1]?delete this.___data___[arguments[0]]:this.___data___[arguments[0]]=arguments[1],this)}});var p=f("ManipulationSupport",t=>{t.empty=function(){let t=this.childNodes;for(;0!=t.length;)t[0].remove(!0);return this},t.content=function(){return this.childNodes},t.html=function(){return 0==arguments.length?this.innerHTML:1==arguments.length&&"boolean"==typeof arguments[0]?arguments[0]?this.outerHTML:this.innerHTML:(Array.from(arguments).forEach(t=>{"string"==typeof t?this.innerHTML=t:(t instanceof Node||t instanceof NodeList)&&(this.empty(),this.append(t))}),this)};const e=function(){const e=t.appendChild.bind(this);for(let t=0;t<arguments.length;t++){let n=arguments[t];n instanceof Node?this.appendChild(n):"string"==typeof n?create(n).forEach(e):"function"==typeof n.forEach&&n.forEach(e)}};t.append=e;const n=function(t,e){this.insertBefore(e,t)};t.prepend=function(){if(0==this.childNodes.length)e.apply(this,arguments);else{const t=this.childNodes.first(),e=n.bind(this,t);for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):"string"==typeof n?n.forEach(e):"function"==typeof n.forEach&&n.forEach(e)}}},t.replace=function(){if(arguments.length<1)throw new Error("Insufficient arguments! One or two nodes required!");const t=1==arguments.length?this.parentNode:this,e=1==arguments.length?this:arguments[0],n=1==arguments.length?arguments[0]:arguments[1];n instanceof Array||n instanceof NodeList||n instanceof HTMLCollection?(n.forEach(n=>t.insertBefore(n,e)),e.remove()):t.replaceChild(n,e)},t.after=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const e=this.parentNode,n=this.nextSibling;n?t.before.apply(n,arguments):t.append.apply(e,arguments)},t.before=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const t=this.parentNode,e=e=>{t.insertBefore(e,this)};for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):"string"==typeof n?n.forEach(e):"function"==typeof n.forEach&&n.forEach(e)}}});l(Node,d,p);const m=/:parent(\(\"([^\)]*)\"\))?/i,y=function(t,e){let n=m.exec(e);if(!n)return t.querySelectorAll(e);{let r=t;if(n.index>0&&(r=t.querySelectorAll(e.substr(0,n.index)),0==r.length))return;if(r=r.parent(n[2]),r){let t=e.substr(n.index+n[0].length).trim();return t.length>0&&(r=r.find(t)),r}}};var g=f("QuerySupport",t=>{t.find=function(){let t=[],e=Array.from(arguments),n=e.shift();for(;n;){if("string"==typeof n){let e=y(this,n);e&&t.push(e)}n=e.shift()}let r=NodeList.from.apply(null,t);return r},t.is=function(){if(this instanceof Document)return!1;if(1==arguments.length){if("string"==typeof arguments[0])return this.matches(arguments[0]);if("number"==typeof arguments[0].length){let t=arguments[0];for(let e=0;e<t.length;e++)if(this.matches(t[e]))return!0}}else if(arguments.length>1)return this.is(Array.from(arguments));return!1},t.parent=function(){if(this.parentNode){if("string"==typeof arguments[0]){let t=this.parentNode;try{for(;t&&!t.is(arguments[0]);)t=t.parent(arguments[0])}catch(e){console.error("this:",this,"parent:",t,"error:",e)}return t}return this.parentNode}},t.parents=function(){let e=new Array,n=t.parent.apply(this,arguments);for(;n;)e.push(n),n=t.parent.apply(n,arguments);return NodeList.from(e)},t.selector=function(){if(!(this instanceof Document||this instanceof DocumentFragment)){if(this.id)return"#"+this.id;{let t=this.tagName.toLowerCase(),e=this.parent();if(e){let n=e.find(":scope>"+t);if(n instanceof NodeList){let e=n.indexOf(this);e>0&&(t+=":nth-child("+(e+1)+")")}let r=e.selector();return r?r+">"+t:t}return t}}},t.closest=function(t){let e=this;for(;e;){let n=e.find(t);if(n&&n.length>0)return n;if(e.is(t))return NodeList.from(e);e=e.parent()}},t.nested=function(t){if(this.is(t))return NodeList.from(this);let e=this.find(t);return e&&e.length>0?e:NodeList.from(this.parent(t))}});const v=f("AttributeSupport",t=>{t.attr=function(){return 0==arguments.length?this.hasAttributes()?(()=>{const t={};return this.getAttributeNames().forEach(e=>{t[e]=this.getAttribute(e)}),t})():void 0:1==arguments.length?this.getAttribute(arguments[0]):(void 0===arguments[1]||null==arguments[1]?this.removeAttribute(arguments[0]):this.setAttribute(arguments[0],arguments[1]),this)}});l(Element,g,v,p);const w=f("ReadyEventSupport",t=>{t.ready=function(t,e){return this.on("ready",t,e),"complete"==document.readyState&&this.trigger("ready"),this}});l(Document,g,w),document.addEventListener("DOMContentLoaded",()=>document.trigger("ready")),l(DocumentFragment,g,p);var _=f("HtmlClassSupport",t=>{t.addClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach(t=>this.classList.add(t)):arguments.length>1&&Array.prototype.forEach.call(arguments,t=>this.addClass(t)),this},t.removeClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach(t=>this.classList.remove(t)):arguments.length>1&&Array.prototype.forEach.call(arguments,t=>this.removeClass(t)),this},t.toggleClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach(t=>this.classList.toggle(t)):arguments.length>1&&Array.prototype.forEach.call(arguments,t=>this.toogleClass(t)),this}});const x=f("ShowHideSupport",t=>{t.show=function(){return this.___hidden__&&(this.style.display=this.___display___||"",this.___hidden__=!1),this},t.hide=function(){return this.___hidden__||(this.___display___=this.style.display,this.style.display="none",this.___hidden__=!0),this},t.toggleShow=function(){return this.___hidden__?this.show():this.hide()}});l(HTMLElement,_,x);const E=[{selector:"select",get:function(){const t=[];return this.find("option").forEach(e=>{e.selected&&t.push(e.value)}),t},set:function(){let t=[];const e=Array.from(arguments);let n=e.shift();for(;n;)Array.isArray(n)?t=t.concat(n):t.push(n),n=e.shift();this.value=t,this.find("option").forEach(e=>e.selected=t.indexOf(e.value)>=0),this.trigger("changed")}},{selector:'input[type="checkbox"], input[type="radio"]',get:function(){return"on"==this.value||"off"==this.value?this.checked:this.checked?this.value:void 0},set:function(t){"boolean"==typeof t?this.checked=t:"string"==typeof t?this.checked=this.value==t:Array.isArray(t)&&(this.checked=t.indexOf(this.value)>=0),this.trigger("changed")}}],N={get:function(){return this.value},set:function(t){this.value=t,this.trigger("input")}},T=function(t){for(let e=0;e<E.length;e++)if(t.is(E[e].selector))return E[e];return N};var L=f("ValueSupport",t=>{t.val=function(){let t=T(this);return 0==arguments.length?t.get.apply(this,arguments):(t.set.apply(this,arguments),this)}});l(HTMLInputElement,L),l(HTMLTextAreaElement,f("ValueSupport",t=>{t.val=function(){return 0==arguments.length?this.value:(this.value=arguments[0],this)}})),l(HTMLSelectElement,L);var b=function(){const t=Array.from(arguments),e=t.shift(),n=t.shift();t.forEach(t=>{Object.getOwnPropertyNames(t).forEach(r=>{const o=Object.getOwnPropertyDescriptor(t,r);void 0===n[r]&&"function"==typeof o.value&&(n[r]=function(){return e.call(this,r,arguments)})})})};var A=f("ListSupport",t=>{t.indexOf=function(){for(let t=0;t<this.length;t++)if(this[t]==arguments[0])return t;return-1},t.forEach=function(){return Array.prototype.forEach.apply(Array.from(this),arguments)},t.map=function(){return Array.prototype.map.apply(Array.from(this),arguments)},t.filter=function(){return Array.prototype.filter.apply(Array.from(this),arguments)},t.first=function(){if(this.length>0)return this[0]},t.last=function(){if(this.length>0)return this[this.length-1]}});l(NodeList,A),NodeList.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,r=[];for(let o=0;o<this.length;o++){const i=this[o];let a;n?a=e.apply([i].concat(t)):"function"==typeof i[e]&&(a=i[e].apply(i,t)),a&&r.push(a)}return r},NodeList.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach(e=>{if("function"==typeof e.val){e.val()&&t.set(e.name||e.id||e.selector(),e.val())}}),t}}else NodeList.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},NodeList.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const r=t.shift();if(void 0!==r&&null!=r)if(r instanceof Node)e[n++]={value:r,enumerable:!0};else if(r instanceof NodeList||r instanceof HTMLCollection||r instanceof Array)for(let t=0;t<r.length;t++)r[t]&&r[t]instanceof Node&&(e[n++]={value:r[t],enumerable:!0})}return e.length={value:n},Object.create(NodeList.prototype,e)},b((function(t,e){let n=[];return this.forEach(r=>{if(r&&"function"==typeof r[t]){const o=r[t].apply(r,e);o&&(o instanceof NodeList?n=n.concat(Array.from(o)):n.push(o))}}),0===n.length?void 0:n[0]instanceof Node||n[0]instanceof NodeList?NodeList.from.apply(null,n):n}),NodeList.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),l(HTMLCollection,A),HTMLCollection.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,r=[];for(let o=0;o<this.length;o++){const i=this[o];let a;n?a=e.apply([i].concat(t)):"function"==typeof i[e]&&(a=i[e].apply(i,t)),a&&r.push(a)}return r},HTMLCollection.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach(e=>{if("function"==typeof e.val){e.val()&&t.set(e.name||e.id||e.selector(),e.val())}}),t}}else HTMLCollection.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},HTMLCollection.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const r=t.shift();if(void 0!==r&&null!=r)if(r instanceof HTMLElement)e[n++]={value:r,enumerable:!0};else if(r instanceof HTMLCollection||r instanceof NodeList||r instanceof Array)for(let t=0;t<r.length;t++)r[t]&&r[t]instanceof HTMLElement&&(e[n++]={value:r[t],enumerable:!0})}return e.length={value:n},Object.create(HTMLCollection.prototype,e)},b((function(t,e){let n=[];return this.forEach(r=>{if(r&&"function"==typeof r[t]){let o=r[t].apply(r,e);o&&(o instanceof HTMLCollection?n=n.concat(Array.from(o)):n.push(o))}}),0===n.length?void 0:n[0]instanceof HTMLElement||n[0]instanceof HTMLCollection?HTMLCollection.from.apply(null,n):n}),HTMLCollection.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),c.default.global.defaultjs=c.default.global.defaultjs||{},c.default.global.defaultjs.extdom=c.default.global.defaultjs.extdom||{VERSION:"1.0.0-beta.1",utils:{Utils:c.default}},c.default.global.find=function(){return document.find.apply(document,arguments)},c.default.global.ready=function(){return document.ready.apply(document,arguments)},c.default.global.create=function(t,e){if("string"!=typeof arguments[0])throw new Error("The first argument must be a string!");const n=document.createElement("template");return n.innerHTML=t,e?n:document.importNode(n.content,!0).childNodes},c.default.global.script=function(t,e){return t instanceof Array?Promise.all(t.map(t=>c.default.global.script(t,e))):"string"==typeof t?new Promise((n,r)=>{const o=document.createElement("script");o.async=!0,o.onload=function(){n()},o.onerror=function(){r("jquery load error!")},e?e.append(o):document.body.append(o),o.src=t}):Promise.reject("First parameter must be an array of strings or a string!")};var M=n(3);class H{constructor(t,e){this.key=t,this.context=e}get keyDefined(){return this.key in this.context}get hasValue(){return!!this.context[this.key]}get value(){return this.context[this.key]}set value(t){this.context[this.key]=t}set append(t){if(this.hasValue){const e=this.value;e instanceof Array?e.push(t):this.value=[this.value,t]}else this.value=t}remove(){delete this.context[this.key]}static load(t,e,n=!0){let r=t;const o=e.split(".");let i=o.shift().trim();for(;o.length>0;){if(!r[i]){if(!n)return null;r[i]={}}r=r[i],i=o.shift().trim()}return new H(i,r)}}const C=function(t){return void 0!==t&&null!=t&&"Object"===t.constructor.name},j=function(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];Object.getOwnPropertyNames(n).forEach(e=>{C(t[e])?j(t[e],n[e]):t[e]=n[e]})}return t};var S={isPojo:C,append:function(t,e,n){if(void 0!==e){H.load(n,t,!0).append=e}return n},merge:j};class O{constructor(t){this.hasValue=1==arguments.length,this.value=t}}const k=/\$\{(([a-zA-Z0-9\-_\s]+)::)?([^\{\}]+)\}/,P=new O,D=t=>t instanceof O?t:new O(t),V=async function(t,e,n,r){if(n&&t.name!=n)return t.parent?V(t.parent,e,n,r):null;let o=null;if(t.context||n)try{o=await async function(t,e){if("string"!=typeof t)return t;const n=new Function("aContext",`try{\n\t\t\t\twith(aContext) {\n\t\t\t\t\treturn ${t};\n\t\t\t\t}\n\t\t\t}catch(e){\n\t\t\t\tthrow e;\n\t\t\t}`);return await n(e)}(e,t.context)}catch(i){if(!(i instanceof ReferenceError&&null!==t.parent)||n)throw i;o=await V(t.parent,e,n,r)}else o=V(t.parent,e,n,r);return null!=o?o:r instanceof O&&r.hasValue?r.value:o};class R{constructor({context:t=M.default,parent:e=null,name:n=null}){this.parent=e instanceof R?e:null,this.name=n,this.context=t}get chain(){return this.parent?this.parent.chain+"/"+this.name:"/"+this.name}get effectiveChain(){return this.context?this.parent?this.parent.effectiveChain+"/"+this.name:"/"+this.name:this.parent?this.parent.effectiveChain:""}getData(t,e){if(t){if(!e||e==this.name){const e=H.load(this.context,t,!1);return e?e.value:null}this.parent&&this.parent.updateData(t,value,e)}}updateData(t,e,n){if(t)if(n&&n!=this.name)this.parent&&this.parent.updateData(t,e,n);else{H.load(this.context,t).value=e}}mergeContext(t,e){e&&e!=this.name?this.parent&&this.parent.mergeContext(t,e):this.context=this.context?S.merge(this.context,t):t}async resolve(t,e){const n=2==arguments.length?D(e):P;try{const e=k.exec(t);return e?await V(this,e[3],(t=>t?0==(t=t.trim()).length?null:t:null)(e[2]),n):await V(this,t,null,n)}catch(e){return console.error('error at executing statment"',t,'":',e),n.hasValue?n.value:t}}async resolveText(t,e){let n=t,r=t,o=k.exec(n);const i=2==arguments.length?D(e):P;for(;null!=o;){const t=await this.resolve(o[0],i);r=r.split(o[0]).join(),n=n.split(o[0]).join(void 0===t?"undefined":null==t?"null":t),o=k.exec(r)}return n}static async resolve(t,e,n,r){const o=new R({context:e}),i=arguments.length>2?D(n):P;return"number"==typeof r&&r>0?new Promise(e=>{setTimeout(()=>{e(o.resolve(t,i))},r)}):o.resolve(t,i)}static async resolveText(t,e,n,r){const o=new R({context:e}),i=arguments.length>2?D(n):P;return"number"==typeof r&&r>0?new Promise(e=>{setTimeout(()=>{e(o.resolveText(t,i))},r)}):o.resolveText(t,i)}}class q{constructor({resolver:t,renderer:e,template:n,container:r,root:o,mode:i="replace",target:a=null,parent:s=null}){if(!t)throw new Error('Parameter "resolver" is required!');if(!e)throw new Error('Parameter "renderer" is required!');if(!n)throw new Error('Parameter "template" is required!');if(!r)throw new Error('Parameter "container" is required!');if(!o)throw new Error('Parameter "root" is required!');this.readyHandles=[],this.finallyHandles=[],this.content=null,this.template=n,this.container=r,this.resolver=t,this.mode=i,this.renderer=e,this.root=o,this.target=a,this.parent=s,this.stop=!1,this.ignore=!1}get finally(){return this.finallyHandles}set finally(t){this.parent?this.parent.finally=t:t instanceof Array?this.readyhandles=this.readyhandles.concat(t):this.readyhandles.push(t)}get ready(){return this.readyHandles=[]}set ready(t){t instanceof Array?this.readyHandles=this.readyHandles.concat(t):this.readyHandles.push(t)}clone({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:r=this.container,root:o=this.root,mode:i=this.mode,target:a=this.target}={}){return new q({resolver:t,renderer:e,template:n,container:r,mode:i,root:o,target:a,parent:this})}}const I=[];class U{constructor(){}get name(){}get rank(){}async execute(t){return t}static define(t){(({directive:t})=>{if(!(t instanceof U))throw new Error("Implementation dosn't extend Directive class!");if(t.rank<0)throw new Error("The rank ofa directive must be positive(0 <= rank)!");I.push(t),I.sort((t,e)=>t.rank-e.rank)})(t)}static get directives(){return I}}class F extends HTMLElement{constructor(){super(),this.hidden=!0}async execute({template:t,context:e}){return e.content=t.cloneNode(!0),e}}class $ extends F{constructor(){super(),this.attachShadow({mode:"open"})}async execute({template:t,context:e}){return e}}customElements.define("jstl-replace",$);U.define({directive:new class extends U{constructor(){super()}get name(){return"initial"}get rank(){return 0}async execute(t){const{template:e}=t;if(e instanceof Text)t.content=document.importNode(e,!0);else if(e.attr("jstl-async")){t.content=new $;const n=document.importNode(e,!0);n.attr("jstl-async",null),setTimeout(async()=>{await t.renderer.render({template:n,mode:"replace",target:t.content,context:t})},parseInt(e.attr("jstl-async")||"250")||250)}else e.attr("jstl-ignore")?(t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0):e.tagName?t.content=document.createElement(e.tagName):(t.stop=!0,t.ignore=!0);return t}}});U.define({directive:new class extends U{constructor(){super()}get name(){return"if"}get rank(){return 1e3}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement&&e.attr("jstl-if")))return t;const n=e.attr("jstl-if"),r=t.resolver;return await r.resolve(n,!1)||(t.content=null,t.stop,t.ignore),t}}});const B={remote:async({data:t,context:e})=>{const{resolver:n,template:r}=e;t=await n.resolveText(t),t=new URL(t,location.origin);let o=await n.resolveText(r.attr("jstl-data-option")||"{}");return o=JSON.parse(o),(t=await fetch(t.toString(),o)).json()},direct:async({data:t,context:e})=>{const{resolver:n}=e;return t=await n.resolveText(t),JSON.parse(t)}};U.define({directive:new class extends U{constructor(){super()}get name(){return"data"}get rank(){return 2e3}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-data")))return t;try{const{template:e}=t,n=B[e.attr("jstl-data-mode")||"remote"];if(!n)throw new Error("The jstl-data-mode is unsupported!");let r=e.attr("jstl-data");r=await n({data:r,context:t}),t=(({varname:t,data:e,scope:n,context:r})=>(t?r.resolver.updateData(t,e,n):n?r.mergeContext(e,n):r.resolver=new R({context:e,name:"jstl-data",parent:r.resolver}),r))({varname:e.attr("jstl-data-var"),data:r,scope:e.attr("jstl-data-scope"),context:t})}catch(t){console.error(t,template)}return t}}});U.define({directive:new class extends U{constructor(){super()}get name(){return"include"}get rank(){return 3e3}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-include")))return t;try{const{template:e,resolver:n,renderer:r}=t;let o=e.attr("jstl-include");o=await n.resolveText(o),o=new URL(o,location.origin),o=await s.load(o);const i=e.attr("jstl-include-mode")||"replace";return await r.render({template:o,container:t.content,mode:i,context:t}),t.ignore,t}catch(e){return console.error(e,t.template),t}}}});U.define({directive:new class extends U{constructor(){super()}get name(){return"text"}get rank(){return 1e4}async execute(t){const{template:e}=t;if(!(e instanceof Text)||0==e.textContent.trim().length)return t;const n=t.resolver;return t.content.textContent=await n.resolveText(e.textContent),t}}});const z=/([\?\+])?(jstl)?([^\?\+]+)/i,J=async({type:t,name:e,value:n,context:r})=>{const{resolver:o,content:i,template:a}=r;let s="?"==t?n:a.attr("?"+e),l="+"==t?n:a.attr("+"+e);s&&l?(s=await o.resolve(s,!1),!0===s&&i.attr(e,await o.resolveText(l))):s?(s=await o.resolve(s,!1),!0===s&&i.attr(e,!0)):l&&i.attr(e,await o.resolveText(l))},G=async({name:t,value:e,context:n})=>{const{resolver:r,content:o}=n;o.attr(t,await r.resolveText(e))};U.define({directive:new class extends U{constructor(){super()}get name(){return"attribute"}get rank(){return 1e4}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement))return t;const n=new Set;for(const r of e.attributes){const[,e,o,i]=z.exec(r.name);if(!o&&!n.has(i)){const n=r.value;e?await J({type:e,name:i,value:n,context:t}):await G({name:i,value:n,context:t})}n.add(i)}return t}}});const Q="data",X="render",Y="node",Z=new R({name:"application"}),K={replace:async({container:t,target:e=null,content:n})=>{e?e.replace(n):(t.empty(),t.append(n))},append:async({container:t,target:e=null,content:n})=>{e?e.after(n):t.append(n)},prepend:async({container:t,target:e=null,content:n})=>{e?e.before(n):t.prepend(n)}},W=t=>t?t instanceof s?t.importContent():t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection?t:"string"==typeof t?create(t):null:null;class tt{constructor({template:t,data:e}={}){this.template=W(t),this.resolver=new R({name:Q,context:e||{},parent:Z})}async render({template:t=this.template,data:e=null,container:n,root:r,mode:o="replace",target:i,context:a=null}){t=W(t)||this.template;let s=new R({name:X,context:e,parent:a?a.resolver:this.resolver}),l=a;l=l?a.clone({resolver:s,template:t,container:n,root:r,mode:o,target:i}):new q({resolver:s,renderer:this,template:t,container:n,root:r||n,mode:o,target:i});let c=null;if(c=t instanceof Node?await this.renderNode(l):await this.renderContainer(l),c instanceof q&&(l=c),l.content&&l.mode){const t=K[l.mode];if(!t)throw new Error('The "'+l.mode+'" is not supported!');await t(l)}return a?a.ready=l.ready:await Promise.all(l.ready.map(t=>t({renderContext:l}))),a}async renderContainer(t){if(t.template&&t.template.length>0){const e=t.template.map(e=>{const n=new R({name:Y,context:null,parent:t.resolver});return this.renderNode(t.clone({template:e,resolver:n}))}),n=await Promise.all(e);if(!n)return t;t.content=n.filter(t=>!!t).reduce((e,n)=>{const r=n.content;return r instanceof Array?e=e.concat(r):r instanceof Node&&e.push(r),t.ready=n.ready,e},[])}return t}async renderNode(t){t.template.normalize();let e=null;if(e=t.template instanceof F?await t.template.execute(t):await this.executeDirectives(t),e instanceof q&&(t=e),!t.ignore&&t.content){const e=t.template.childNodes;e&&e.length>0&&await t.renderer.render({template:e,container:t.content,context:t})}return t}async executeDirectives(t){const e=U.directives,n=e.length;for(let r=0;r<n&&!t.stop;r++){const n=e[r],o=await n.execute(t);o instanceof q&&(t=o)}return t}static async render({container:t,data:e,template:n,mode:r,target:o}){return new tt({template:n,data:e}).render({container:t,mode:r,target:o})}}r.default.defaultjs=r.default.defaultjs||{},r.default.defaultjs.tl=r.default.defaultjs.tl||{VERSION:"1.0.0-beta.1",Template:s,Renderer:tt}}]);
//# sourceMappingURL=defaultjs-template-language.min.js.map